–Ω–∞–ø–æ–º–Ω—é —á—Ç–æ —É –º–µ–Ω—è —Ç–∞–∫–æ–π –∫–æ–¥
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∞—Ä–º –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è 3D üíä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
       
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a1a;
            color: white;
            touch-action: none;
        }
       
        #scene-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
       
        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }
       
        /* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        .info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(100, 150, 255, 0.3);
            max-width: 320px;
            pointer-events: auto;
        }
       
        .info-panel h2 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
       
        .stat-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 8px 0;
            overflow: hidden;
        }
       
        .stat-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
       
        /* –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        #mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: none;
            pointer-events: auto;
            z-index: 10;
        }
       
        .joystick-area {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
       
        .joystick {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(100, 150, 255, 0.8);
            border-radius: 50%;
            top: 35px;
            left: 35px;
            touch-action: none;
        }
       
        .action-buttons {
            position: absolute;
            bottom: 40px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
       
        .action-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 100, 100, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            border: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            touch-action: none;
            cursor: pointer;
        }
       
        .action-btn:active {
            transform: scale(0.95);
            background: rgba(255, 100, 100, 1);
        }
       
        /* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã */
        #camera-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            pointer-events: auto;
            cursor: pointer;
            z-index: 11;
        }
       
        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        #inventory {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 12px;
            min-width: 200px;
            pointer-events: auto;
            border: 2px solid rgba(100, 255, 100, 0.3);
        }
       
        .inventory-slots {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
       
        .inventory-slot {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            position: relative;
        }
       
        .inventory-slot.filled {
            background: rgba(100, 255, 100, 0.2);
            border: 2px solid #64ff64;
        }
       
        .drug-name {
            font-size: 10px;
            margin-top: 2px;
            opacity: 0.8;
        }
       
        /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è */
        #interaction-hint {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 12px 24px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
            white-space: nowrap;
            border: 2px solid #64b5f6;
            pointer-events: none;
            z-index: 100;
        }
       
        /* –û–≤–µ—Ä–ª–µ–π –∞–Ω–∏–º–∞—Ü–∏–π */
        .animation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
       
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–µ—Ç–æ–∫ */
        .cell-animation {
            background: radial-gradient(circle at center, rgba(0, 255, 0, 0.1), transparent);
        }
       
        .immune-cell {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #00ff00;
            border-radius: 50%;
            filter: blur(1px);
            animation: immuneFloat 3s linear infinite;
        }
       
        .bacteria-cell {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ff0000;
            border-radius: 50%;
            filter: blur(1px);
            animation: bacteriaFloat 2s linear infinite;
        }
       
        .antibody-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00ffff;
            border-radius: 50%;
            filter: blur(2px);
            animation: antibodyMove 1s linear forwards;
        }
       
        @keyframes immuneFloat {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(10px, -10px); }
            50% { transform: translate(0, -20px); }
            75% { transform: translate(-10px, -10px); }
        }
       
        @keyframes bacteriaFloat {
            0%, 100% { transform: translate(0, 0) rotate(0); }
            50% { transform: translate(15px, 15px) rotate(180deg); }
        }
       
        @keyframes antibodyMove {
            from {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            to {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
       
        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–∏—è–Ω–∏—è */
        .glow-animation {
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.2), transparent 70%);
            animation: pulseGlow 2s ease-in-out;
        }
       
        @keyframes pulseGlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
       
        /* –≠—Ñ—Ñ–µ–∫—Ç —Ü–≤–µ—Ç–∞ */
        .color-wave {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: colorPulse 3s ease;
        }
       
        @keyframes colorPulse {
            0% {
                background: transparent;
                opacity: 0;
            }
            20% {
                background: var(--wave-color);
                opacity: 0.7;
            }
            100% {
                background: transparent;
                opacity: 0;
            }
        }
       
        /* –í—Å–ø—ã—à–∫–∞ */
        .flash-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            animation: flash 0.5s ease-out;
        }
       
        @keyframes flash {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
       
        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        #message-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px 40px;
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 1001;
            border: 3px solid #64b5f6;
            max-width: 80%;
            pointer-events: none;
        }
       
        /* –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è */
        #game-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
       
        .complete-content {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #1a237e, #311b92);
            border-radius: 20px;
            max-width: 600px;
            border: 4px solid gold;
        }
       
        /* –°–Ω–µ–≥ */
        #snow-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
        }
       
        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞ */
        .patient-highlight {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 0, 0.3), transparent 70%);
            pointer-events: none;
            z-index: 1;
            animation: pulse 2s infinite;
        }
       
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }
       
        /* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –º–∞–Ω–∏–∫–µ–Ω–µ */
        .manikin-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--effect-color), transparent 70%);
            pointer-events: none;
            z-index: 1;
            animation: expand 1.5s ease-out;
        }
       
        @keyframes expand {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
       
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
        @media (max-width: 768px) {
            .info-panel {
                max-width: calc(100% - 20px);
                font-size: 14px;
                padding: 10px;
            }
           
            #mobile-controls {
                display: block;
            }
           
            #inventory {
           top: auto;
           bottom: 180px; /* –ù–∞–¥ –º–æ–±–∏–ª—å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º */
            right: 10px;
           padding: 8px;
           min-width: 140px;
           font-size: 0.9em;
           transform: scale(0.85);
           transform-origin: bottom right;
          }
           
            .inventory-slot {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
           
            .drug-name {
                font-size: 8px;
            }
           
            .action-btn {
                width: 50px;
                height: 50px;
            }
           
            .joystick-area {
                width: 100px;
                height: 100px;
            }
           
            .joystick {
                width: 40px;
                height: 40px;
                top: 30px;
                left: 30px;
            }
        }
        /* –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Å—Ç–∏–ª—å –¥–ª—è –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ */
        #music-control {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            pointer-events: auto;
            cursor: pointer;
            z-index: 11;
        }
       
        /* –ê–Ω–∏–º–∞—Ü–∏—è –º–æ–ª–µ–∫—É–ª—è—Ä–Ω–æ–π –±–∏—Ç–≤—ã */
        .molecule-battle {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1), transparent);
        }
       
        .molecule {
            position: absolute;
            border-radius: 50%;
            animation: moleculeFloat 2s ease-in-out infinite;
        }
       
        .good-molecule {
            background: #00ff00;
            box-shadow: 0 0 20px #00ff00;
        }
       
        .bad-molecule {
            background: #ff0000;
            box-shadow: 0 0 20px #ff0000;
        }
       
        @keyframes moleculeFloat {
            0%, 100% { transform: translate(0, 0) rotate(0); }
            33% { transform: translate(10px, -10px) rotate(120deg); }
            66% { transform: translate(-10px, 10px) rotate(240deg); }
        }
       
.patient-label {
    position: absolute;
    background: rgba(0, 0, 0, 0.85);
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    font-size: 14px;
    pointer-events: none;
    z-index: 2;
    border: 2px solid #ff4444;
    white-space: nowrap;
    transform: translate(-50%, -100%);
    margin-top: -10px;
    text-align: center;
    min-width: 200px;
}
.patient-label h4 {
    margin: 0 0 5px 0;
    color: #ffcc00;
    font-size: 16px;
}
.patient-label .diagnosis {
    color: #ff6666;
    font-weight: bold;
    margin: 0 0 3px 0;
}
.patient-label .description {
    color: #88ff88;
    font-size: 12px;
    opacity: 0.9;
    margin: 0;
}
.patient-label.healed {
    border-color: #00ff00;
}
.patient-label.healed .diagnosis {
    color: #00ff00;
}
@keyframes floatHeart {
    0% {
        transform: translateY(0) rotate(0deg) scale(1);
        opacity: 0.8;
    }
    50% {
        transform: translateY(-60vh) rotate(180deg) scale(1.2);
        opacity: 1;
    }
    100% {
        transform: translateY(-120vh) rotate(360deg) scale(0.8);
        opacity: 0;
    }
}
/* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
#mobile-hint {
    pointer-events: auto; /* –ß—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞–∂–∞—Ç—å –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫ */
    position: absolute;
    bottom: 180px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: #64b5f6;
    padding: 15px 20px;
    border-radius: 12px;
    font-size: 13px;
    text-align: center;
    display: none;
    z-index: 12;
    border: 1px solid #64b5f6;
    max-width: 90%;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}
/* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
    #mobile-hint {
        display: block;
    }
   
    .complete-content {
        padding: 20px;
        margin: 10px;
    }
   
    .complete-content button {
        padding: 12px 20px;
        font-size: 1em;
    }
}
.patient-label {
        font-size: 12px;
        padding: 6px 12px;
        min-width: 150px;
        max-width: 80vw;
    }
    .patient-highlight {
        width: 120px;
        height: 120px;
    }
    /* –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
    #patient-label-0 { left: 50% !important; top: 25% !important; } /* –ì—Ä–∏–≥–æ—Ä–∏–π */
    #patient-label-1 { left: 15% !important; top: 30% !important; } /* –ú–∞—Ä–∏—è */
    #patient-label-2 { right: 15% !important; top: 30% !important; } /* –ò–≤–∞–Ω */
    #patient-highlight-0 { left: 50% !important; top: 35% !important; }
    #patient-highlight-1 { left: 15% !important; top: 40% !important; }
    #patient-highlight-2 { right: 15% !important; top: 40% !important; }
    </style>
</head>
<body>
     <audio id="background-music" loop>
        <source src="music.mp3" type="audio/mpeg">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
    </audio>
   
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Three.js -->
    <div id="scene-container"></div>
   
    <!-- –•–æ–ª—Å—Ç –¥–ª—è —Å–Ω–µ–≥–∞ -->
    <canvas id="snow-canvas"></canvas>
   
    <div id="mobile-hint">
    <button id="close-hint" style="
        position: absolute;
        top: 4px;
        right: 8px;
        background: none;
        border: none;
        color: #64b5f6;
        font-size: 18px;
        cursor: pointer;
        width: 24px;
        height: 24px;
        padding: 0;
        opacity: 0.7;
    ">√ó</button>
    <strong>üëÜ –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º –ø–æ —ç–∫—Ä–∞–Ω—É</strong><br>–¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –∫–∞–º–µ—Ä—ã<br><br>
    <strong>üéÆ –î–∂–æ–π—Å—Ç–∏–∫ —Å–ª–µ–≤–∞</strong> ‚Äî –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è<br>
    <strong>üî¥ –ö–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞–≤–∞</strong> ‚Äî –¥–µ–π—Å—Ç–≤–∏–µ (E)
</div>
    <!-- UI –æ–≤–µ—Ä–ª–µ–π -->
    <div id="ui-overlay">
        <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
        <div class="info-panel">
            <h2>üè• –§–∞—Ä–º –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è</h2>
           <!--p>–ü–∞—Ü–∏–µ–Ω—Ç: <span id="patient-name" style="color: #ffcc00;">–ì—Ä–∏–≥–æ—Ä–∏–π</span></p>
            <p>–î–∏–∞–≥–Ω–æ–∑: <span id="patient-diagnosis" style="color: #ff6666;">–ì—Ä–∏–ø–ø —Å –≤—ã—Å–æ–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π</span></!p-->
            <p style="font-size: 12px; color: #64b5f6; margin-top: 5px;">üìç –ü–∞—Ü–∏–µ–Ω—Ç—ã —É –∑–∞–¥–Ω–µ–π —Å—Ç–µ–Ω—ã —Å –∫—Ä–∞—Å–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π</p>
            <p style="font-size: 12px; color: #88ff88; margin-top: 5px;">‚úÖ –í—ã–ª–µ—á–µ–Ω–æ: <span id="cured-count">0/3</span></p>
           
            <div style="margin: 15px 0;">
                <div style="display: flex; justify-content: space-between;">
                    <span>üí™ –ó–¥–æ—Ä–æ–≤—å–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞:</span>
                    <span id="health-value">100%</span>
                </div>
                <div class="stat-bar">
                    <div class="stat-fill" id="health-bar" style="width: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a);">100%</div>
                </div>
            </div>
           
            <div>
                <div style="display: flex; justify-content: space-between;">
                    <span>‚ö° –ü—Ä–æ–≥—Ä–µ—Å—Å –ª–µ—á–µ–Ω–∏—è:</span>
                    <span id="progress-value">0%</span>
                </div>
                <div class="stat-bar">
                    <div class="stat-fill" id="progress-bar" style="width: 0%; background: linear-gradient(90deg, #2196f3, #03a9f4);">0%</div>
                </div>
            </div>
           
            <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                üîç –ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –∏ –æ—Ç–Ω–µ—Å–∏—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç—É
            </p>
        </div>
       
        <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã -->
        <div id="camera-toggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É">üì∑</div>
       
        <!-- –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—É–∑—ã–∫–æ–π -->
        <div id="music-control" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É">üéµ</div>
       
        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div id="inventory">
            <h3>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (E)</h3>
            <p style="font-size: 12px; opacity: 0.7; margin-bottom: 10px;">–¢–µ–∫—É—â–∏–π –ø—Ä–µ–ø–∞—Ä–∞—Ç: <span id="current-drug">–ù–µ—Ç</span></p>
            <div class="inventory-slots">
                <div class="inventory-slot" id="slot1">
                    <div class="drug-icon"></div>
                    <div class="drug-name"></div>
                </div>
                <div class="inventory-slot" id="slot2">
                    <div class="drug-icon"></div>
                    <div class="drug-name"></div>
                </div>
                <div class="inventory-slot" id="slot3">
                    <div class="drug-icon"></div>
                    <div class="drug-name"></div>
                </div>
            </div>
        </div>
       
        <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è -->
        <div id="interaction-hint">–ù–∞–∂–º–∏—Ç–µ E –∏–ª–∏ –∫–Ω–æ–ø–∫—É –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</div>
       
        <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
        <div id="mobile-controls">
            <div class="joystick-area">
                <div class="joystick" id="joystick"></div>
            </div>
            <div class="action-buttons">
                <button class="action-btn" id="action-btn">E</button>
            </div>
        </div>
    </div>
   
    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π -->
    <div id="animation-overlay" class="animation-overlay"></div>
   
    <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π -->
    <div id="message-display"></div>
   
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
    <div id="game-complete">
    <div class="complete-content">
        <h1 style="font-size: 2.5em; margin-bottom: 20px;">–ú–ò–°–°–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ê!</h1>
        <p style="font-size: 1.2em; margin-bottom: 20px;">–¢—ã —Å–ø–∞—Å–ª–∞ –≤—Å–µ—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤! –¢–≤–æ—è –∑–∞–±–æ—Ç–∞ –∏ –≤–Ω–∏–º–∞–Ω–∏–µ —Ç–≤–æ—Ä–∏—Ç —á—É–¥–µ—Å–∞! ‚ù§Ô∏è</p>
       
        <div style="margin: 25px 0; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 15px;">
            <p style="font-size: 1.3em; color: #ffcc00; margin-bottom: 10px;">üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è —Ç–µ–±—è:</p>
            <p style="font-size: 1.1em; margin-bottom: 15px;">–ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —Ç—ã –ø–æ–º–æ–≥–∞–µ—à—å –¥—Ä—É–≥–∏–º, —Ç—ã –¥–µ–ª–∞–µ—à—å –º–∏—Ä –ª—É—á—à–µ!</p>
            <p style="font-size: 1em; color: #88ff88;">–¢–≤–æ—è –¥–æ–±—Ä–æ—Ç–∞ - —Å–∞–º–æ–µ —Ü–µ–Ω–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ! üíä‚ú®</p>
        </div>
       
        <p style="font-size: 1.5em; color: #ff66b2; margin: 20px 0; font-family: 'Segoe UI', cursive;">
            üíù –° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! üíù
        </p>
       
        <div style="display: flex; flex-direction: column; gap: 20px; justify-content: center; align-items: center; margin-top: 30px;">
            <button onclick="location.reload()" style="
                padding: 15px 30px;
                background: linear-gradient(135deg, #ff66b2, #ff3388);
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 1.1em;
                cursor: pointer;
                width: 280px;
            ">
                üíï –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
           
            <button onclick="window.open('https://t.me/Tess121sts_main_bot', '_blank')" style="
                padding: 15px 30px;
                background: linear-gradient(135deg, #0088cc, #00aaff);
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 1.1em;
                cursor: pointer;
                width: 280px;
            ">
                üéÅ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ –≤ Telegram
            </button>
        </div>
       
        <p style="margin-top: 40px; font-size: 0.9em; opacity: 0.7;">
            –°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é! üíñ
        </p>
    </div>
</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ==========
        const CONFIG = {
            playerSpeed: 0.15,
            mobileSpeed: 0.12,
            cameraHeight: 1.6,
            interactionDistance: 3,
            worldSize: 20,
            cellCount: 30
        };
        // ========== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ==========
        let scene, camera, renderer;
        let player, playerMesh;
        let keys = {};
        let mouseX = 0, mouseY = 0;
        let cameraMode = 'firstPerson';
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let joystickActive = false;
        let joystickVector = { x: 0, y: 0 };
       
        let currentPatient = 0;
        let patientHealth = 100;
        let patientProgress = 0;
        let inventory = [];
        let gameObjects = [];
        let currentInteraction = null;
        let animationId = null;
        let cameraInitialized = false;
        let snowParticles = [];
        let patientHighlights = [];
        let originalDrugPositions = new Map(); // –•—Ä–∞–Ω–∏—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤
        let curedPatientsCount = 0;
        let totalPatients = 3;
        let isCameraAnimating = false;
        let touchStartX = 0;
let touchStartY = 0;
let isTouching = false;
let touchSensitivity = 0.005; // –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞—Å–∞–Ω–∏—è
// –î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é setupMobileControls():
function setupMobileControls() {
    if (!isMobile) return;
    const joystick = document.getElementById('joystick');
    const joystickArea = document.querySelector('.joystick-area');
    const actionBtn = document.getElementById('action-btn');
    const sceneContainer = document.getElementById('scene-container');
    let joystickStartX = 0;
    let joystickStartY = 0;
    // === 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–∞—Å–∞–Ω–∏–µ –ù–ï –≤ –∑–æ–Ω–µ –¥–∂–æ–π—Å—Ç–∏–∫–∞ –∏ –ù–ï –Ω–∞ –∫–Ω–æ–ø–∫–µ ===
    sceneContainer.addEventListener('touchstart', (e) => {
        const touch = e.touches[0];
        const target = document.elementFromPoint(touch.clientX, touch.clientY);
        // –ï—Å–ª–∏ –∫–æ—Å–Ω—É–ª–∏—Å—å –¥–∂–æ–π—Å—Ç–∏–∫–∞ –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
        if (joystickArea.contains(target) || actionBtn.contains(target)) {
            return;
        }
        isTouching = true;
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
        e.preventDefault(); // –¢–æ–ª—å–∫–æ –∑–¥–µ—Å—å ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ
    });
    sceneContainer.addEventListener('touchmove', (e) => {
        if (!isTouching) return;
        const touch = e.touches[0];
        const deltaX = touch.clientX - touchStartX;
        const deltaY = touch.clientY - touchStartY;
        mouseX += deltaX * touchSensitivity;
        mouseY += deltaY * touchSensitivity;
        mouseY = Math.max(-Math.PI/2, Math.min(Math.PI/2, mouseY));
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
        e.preventDefault();
    });
    sceneContainer.addEventListener('touchend', () => {
        isTouching = false;
    });
    // === 2. –î–∂–æ–π—Å—Ç–∏–∫ ===
    joystickArea.addEventListener('touchstart', (e) => {
        e.stopPropagation(); // –¢–æ–ª—å–∫–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ
        // –ù–ï –≤—ã–∑—ã–≤–∞–µ–º preventDefault() –∑–¥–µ—Å—å –≥–ª–æ–±–∞–ª—å–Ω–æ!
        joystickActive = true;
        const rect = joystickArea.getBoundingClientRect();
        joystickStartX = rect.left + rect.width / 2;
        joystickStartY = rect.top + rect.height / 2;
        updateJoystick(e.touches[0]);
    });
    joystickArea.addEventListener('touchmove', (e) => {
        if (joystickActive) {
            e.stopPropagation();
            updateJoystick(e.touches[0]);
        }
    });
    joystickArea.addEventListener('touchend', (e) => {
        e.stopPropagation();
        joystickActive = false;
        joystickVector = { x: 0, y: 0 };
        joystick.style.transform = 'translate(35px, 35px)';
    });
    // === 3. –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ===
    actionBtn.addEventListener('touchstart', (e) => {
        e.stopPropagation();
        interact();
        actionBtn.style.transform = 'scale(0.95)';
    });
    actionBtn.addEventListener('touchend', (e) => {
        e.stopPropagation();
        actionBtn.style.transform = 'scale(1)';
    });
    function updateJoystick(touch) {
        const x = touch.clientX - joystickStartX;
        const y = touch.clientY - joystickStartY;
        const distance = Math.sqrt(x * x + y * y);
        const maxDistance = 35;
        if (distance > maxDistance) {
            const angle = Math.atan2(y, x);
            joystickVector.x = Math.cos(angle);
            joystickVector.y = Math.sin(angle);
            const limitedX = Math.cos(angle) * maxDistance;
            const limitedY = Math.sin(angle) * maxDistance;
            joystick.style.transform = `translate(${limitedX + 35}px, ${limitedY + 35}px)`;
        } else {
            joystickVector.x = x / maxDistance;
            joystickVector.y = y / maxDistance;
            joystick.style.transform = `translate(${x + 35}px, ${y + 35}px)`;
        }
    }
}
        // ========== –ë–ê–ó–ê –î–ê–ù–ù–´–• ==========
        const DRUG_DATABASE = {
            paracetamol: {
                name: "–ü–∞—Ä–∞—Ü–µ—Ç–∞–º–æ–ª",
                color: 0xFFFF88,
                icon: "üå°Ô∏è",
                effect: 25,
                animation: "feverReduction",
                description: "–°–Ω–∏–∂–∞–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∏ –±–æ–ª—å",
                targetArea: "head",
                effectColor: "#00ffff"
            },
            amoxicillin: {
                name: "–ê–º–æ–∫—Å–∏—Ü–∏–ª–ª–∏–Ω",
                color: 0xFF4444,
                icon: "üíä",
                effect: 40,
                animation: "antibiotic",
                description: "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫ —à–∏—Ä–æ–∫–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞",
                targetArea: "chest",
                effectColor: "#ff0000"
            },
            aspirin: {
                name: "–ê—Å–ø–∏—Ä–∏–Ω",
                color: 0xFFFFFF,
                icon: "üíä",
                effect: 15,
                animation: "painRelief",
                description: "–ü—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ",
                targetArea: "joints",
                effectColor: "#ff8800"
            },
            ibuprofen: {
                name: "–ò–±—É–ø—Ä–æ—Ñ–µ–Ω",
                color: 0xFF8844,
                icon: "üî•",
                effect: 20,
                animation: "antiInflammatory",
                description: "–°–Ω–∏–º–∞–µ—Ç –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –∏ –±–æ–ª—å",
                targetArea: "body",
                effectColor: "#ff4444"
            },
            omeprazole: {
                name: "–û–º–µ–ø—Ä–∞–∑–æ–ª",
                color: 0xCC88FF,
                icon: "üõ°Ô∏è",
                effect: 30,
                animation: "stomachProtection",
                description: "–ó–∞—â–∏—â–∞–µ—Ç –∂–µ–ª—É–¥–æ–∫",
                targetArea: "stomach",
                effectColor: "#cc00ff"
            }
        };
        const PATIENTS = [
            {
                name: "–ì—Ä–∏–≥–æ—Ä–∏–π",
                diagnosis: "–ì—Ä–∏–ø–ø —Å –≤—ã—Å–æ–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π",
                correctDrug: "paracetamol",
                position: { x: 0, y: 0, z: 8 },
                description: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 39¬∞C, –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å"
            },
            {
                name: "–ú–∞—Ä–∏—è",
                diagnosis: "–ë–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–µ–∫—Ü–∏—è",
                correctDrug: "amoxicillin",
                position: { x: -6, y: 0, z: 8 },
                description: "–ê–Ω–≥–∏–Ω–∞, –∫–∞—à–µ–ª—å, —Å–ª–∞–±–æ—Å—Ç—å"
            },
            {
                name: "–ò–≤–∞–Ω",
                diagnosis: "–í–æ—Å–ø–∞–ª–µ–Ω–∏–µ —Å—É—Å—Ç–∞–≤–æ–≤",
                correctDrug: "ibuprofen",
                position: { x: 6, y: 0, z: 8 },
                description: "–ë–æ–ª—å –≤ –∫–æ–ª–µ–Ω—è—Ö, –æ—Ç–µ–∫"
            }
        ];
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
                function init() {
            createScene();
            createLights();
            createWorld();
            createPlayer();
            createDrugs();
            createPatients();
            createChristmasTree();
            setupControls();
            setupMobileControls();
            setupEventListeners();
            initSnow();
          
            // –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
            setTimeout(() => {
                const music = document.getElementById('background-music');
                music.volume = 0.3;
                music.play().catch(e => console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ"));
            }, 1000);
          
            cameraInitialized = true;
            updateUI();
            animate();
            // === –û–ë–†–ê–ë–û–¢–ö–ê –ú–û–ë–ò–õ–¨–ù–û–ô –ü–û–î–°–ö–ê–ó–ö–ò (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏) ===
            const mobileHint = document.getElementById('mobile-hint');
            const closeHintBtn = document.getElementById('close-hint');
            if (closeHintBtn) {
                closeHintBtn.addEventListener('click', () => {
                    mobileHint.style.display = 'none';
                    localStorage.setItem('mobileHintClosed', 'true');
                });
            }
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—ë –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª
            if (isMobile && localStorage.getItem('mobileHintClosed') !== 'true') {
                mobileHint.style.display = 'block';
            } else {
                mobileHint.style.display = 'none';
            }
        }
        function createScene() {
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0a0a1a, 5, 15);
            scene.background = new THREE.Color(0x0a0a1a);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, CONFIG.cameraHeight, 0);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('scene-container').appendChild(renderer.domElement);
        }
        function createLights() {
            // –û—Å–Ω–æ–≤–Ω–æ–π —Å–≤–µ—Ç
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            const mainLight = new THREE.DirectionalLight(0xffffff, 0.9);
            mainLight.position.set(5, 10, 5);
            mainLight.castShadow = true;
            mainLight.shadow.mapSize.width = 2048;
            mainLight.shadow.mapSize.height = 2048;
            scene.add(mainLight);
            // –ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
            const christmasLight1 = new THREE.PointLight(0xff0000, 0.3, 10);
            christmasLight1.position.set(-8, 3, 0);
            scene.add(christmasLight1);
            const christmasLight2 = new THREE.PointLight(0x00ff00, 0.3, 10);
            christmasLight2.position.set(8, 3, 0);
            scene.add(christmasLight2);
        }
        function createWorld() {
            // –ü–æ–ª (—Å —É–∑–æ—Ä–æ–º)
            const floorGeometry = new THREE.PlaneGeometry(CONFIG.worldSize, CONFIG.worldSize);
            const floorTexture = createGridTexture();
            const floorMaterial = new THREE.MeshStandardMaterial({
                map: floorTexture,
                color: 0x3a3a7e,
                metalness: 0.3,
                roughness: 0.8
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            // –°—Ç–µ–Ω—ã
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0x2a3a5e,
                side: THREE.DoubleSide
            });
            const wallGeometry = new THREE.BoxGeometry(CONFIG.worldSize, 4, 0.2);
            // –ó–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∞ (–≥–¥–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã)
            const backWall = new THREE.Mesh(wallGeometry, wallMaterial);
            backWall.position.set(0, 2, -CONFIG.worldSize/2 + 1);
            backWall.receiveShadow = true;
            scene.add(backWall);
            // –ü–µ—Ä–µ–¥–Ω—è—è —Å—Ç–µ–Ω–∞
            const frontWall = new THREE.Mesh(wallGeometry, wallMaterial);
            frontWall.position.set(0, 2, CONFIG.worldSize/2 - 1);
            scene.add(frontWall);
            // –ë–æ–∫–æ–≤—ã–µ —Å—Ç–µ–Ω—ã
            const sideWallGeometry = new THREE.BoxGeometry(0.2, 4, CONFIG.worldSize);
            const leftWall = new THREE.Mesh(sideWallGeometry, wallMaterial);
            leftWall.position.set(-CONFIG.worldSize/2 + 1, 2, 0);
            leftWall.receiveShadow = true;
            scene.add(leftWall);
            const rightWall = new THREE.Mesh(sideWallGeometry, wallMaterial);
            rightWall.position.set(CONFIG.worldSize/2 - 1, 2, 0);
            rightWall.receiveShadow = true;
            scene.add(rightWall);
            // –ü–æ—Ç–æ–ª–æ–∫
            const ceilingGeometry = new THREE.PlaneGeometry(CONFIG.worldSize, CONFIG.worldSize);
            const ceilingMaterial = new THREE.MeshStandardMaterial({
                color: 0x2a2a4e
            });
            const ceiling = new THREE.Mesh(ceilingGeometry, ceilingMaterial);
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.y = 4;
            ceiling.receiveShadow = true;
            scene.add(ceiling);
            // –°—Ç–æ–ª—ã
            const tableGeometry = new THREE.BoxGeometry(1.5, 0.2, 0.8);
            const tableMaterial = new THREE.MeshStandardMaterial({
                color: 0x5a5a8e,
                metalness: 0.5,
                roughness: 0.5
            });
            for (let i = -2; i <= 2; i++) {
                for (let j = -1; j <= 1; j++) {
                    const table = new THREE.Mesh(tableGeometry, tableMaterial);
                    table.position.set(i * 3, 0.1, j * 4);
                    table.castShadow = true;
                    table.receiveShadow = true;
                    scene.add(table);
                   
                    // –ù–æ–∂–∫–∏ —Å—Ç–æ–ª–∞
                    for (let k = -1; k <= 1; k += 2) {
                        for (let l = -1; l <= 1; l += 2) {
                            const legGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.7, 8);
                            const leg = new THREE.Mesh(legGeometry, tableMaterial);
                            leg.position.set(
                                i * 3 + k * 0.6,
                                -0.35,
                                j * 4 + l * 0.3
                            );
                            leg.castShadow = true;
                            scene.add(leg);
                        }
                    }
                }
            }
            // –°—Ç–µ–ª–ª–∞–∂–∏ —Å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º–∏
            for (let i = -2; i <= 2; i++) {
                const shelfGeometry = new THREE.BoxGeometry(2.8, 0.1, 0.6);
                const shelfMaterial = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
                const shelf = new THREE.Mesh(shelfGeometry, shelfMaterial);
                shelf.position.set(i * 3, 1.5, -6);
                shelf.castShadow = true;
                scene.add(shelf);
            }
        }
        function createGridTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
           
            ctx.fillStyle = '#3a3a7e';
            ctx.fillRect(0, 0, 256, 256);
           
            ctx.strokeStyle = '#4a4a9e';
            ctx.lineWidth = 2;
           
            for (let i = 0; i <= 256; i += 32) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, 256);
                ctx.stroke();
               
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(256, i);
                ctx.stroke();
            }
           
            const texture = new THREE.CanvasTexture(canvas);
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.RepeatWrapping;
            texture.repeat.set(8, 8);
           
            return texture;
        }
        function createPlayer() {
            // –¢–µ–ª–æ –∏–≥—Ä–æ–∫–∞
            const bodyGeometry = new THREE.CylinderGeometry(0.2, 0.2, 0.8, 8);
            const bodyMaterial = new THREE.MeshStandardMaterial({
                color: 0x4caf50,
                emissive: 0x1b5e20,
                emissiveIntensity: 0.2
            });
           
            playerMesh = new THREE.Mesh(bodyGeometry, bodyMaterial);
            playerMesh.position.y = 0.4;
            playerMesh.castShadow = true;
            scene.add(playerMesh);
            // –ì–æ–ª–æ–≤–∞ –∏–≥—Ä–æ–∫–∞
            const headGeometry = new THREE.SphereGeometry(0.2, 8, 8);
            const headMaterial = new THREE.MeshStandardMaterial({ color: 0xffcc99 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 0.9;
            playerMesh.add(head);
            player = {
                position: new THREE.Vector3(0, CONFIG.cameraHeight, 0),
                rotation: new THREE.Euler(0, 0, 0, 'YXZ'),
                velocity: new THREE.Vector3()
            };
        }
         function createDrugs() {
            const drugKeys = Object.keys(DRUG_DATABASE);
            const positions = [
                [-7, 1.6, -6], [-4, 1.6, -6], [-1, 1.6, -6], [2, 1.6, -6], [5, 1.6, -6],
                [-7, 1.6, 0], [-4, 1.6, 0], [-1, 1.6, 0], [2, 1.6, 0], [5, 1.6, 0]
            ];
            drugKeys.forEach((key, i) => {
                if (i >= positions.length) return;
               
                const drug = DRUG_DATABASE[key];
                const pos = positions[i];
               
                // –°–æ–∑–¥–∞–Ω–∏–µ –±—É—Ç—ã–ª–æ—á–∫–∏
                const bottleGroup = new THREE.Group();
                bottleGroup.userData = {
                    type: 'drug',
                    id: key,
                    data: drug,
                    taken: false,
                    originalPosition: new THREE.Vector3(pos[0], pos[1], pos[2])
                };
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                originalDrugPositions.set(bottleGroup, {
                    x: pos[0],
                    y: pos[1],
                    z: pos[2]
                });
                // –ë—É—Ç—ã–ª–∫–∞
                const bottleGeometry = new THREE.CylinderGeometry(0.1, 0.13, 0.4, 16);
                const bottleMaterial = new THREE.MeshPhongMaterial({
                    color: drug.color,
                    transparent: true,
                    opacity: 0.9,
                    shininess: 100
                });
                const bottle = new THREE.Mesh(bottleGeometry, bottleMaterial);
                bottle.castShadow = true;
                bottleGroup.add(bottle);
                // –ö—Ä—ã—à–∫–∞
                const capGeometry = new THREE.CylinderGeometry(0.13, 0.13, 0.06, 16);
                const capMaterial = new THREE.MeshStandardMaterial({
                    color: 0x333333,
                    metalness: 0.8,
                    roughness: 0.2
                });
                const cap = new THREE.Mesh(capGeometry, capMaterial);
                cap.position.y = 0.23;
                cap.castShadow = true;
                bottleGroup.add(cap);
                // –≠—Ç–∏–∫–µ—Ç–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º
                const createLabel = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 128;
                    canvas.height = 64;
                    const ctx = canvas.getContext('2d');
                   
                    // –§–æ–Ω —ç—Ç–∏–∫–µ—Ç–∫–∏
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, 128, 64);
                   
                    // –†–∞–º–∫–∞
                    ctx.strokeStyle = '#333333';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(2, 2, 124, 60);
                   
                    // –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞
                    ctx.fillStyle = '#000000';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(drug.name.substring(0, 12), 64, 32);
                   
                    return canvas;
                };
                const labelCanvas = createLabel();
                const labelTexture = new THREE.CanvasTexture(labelCanvas);
                const labelGeometry = new THREE.PlaneGeometry(0.2, 0.1);
                const labelMaterial = new THREE.MeshBasicMaterial({
                    map: labelTexture,
                    transparent: true
                });
                const label = new THREE.Mesh(labelGeometry, labelMaterial);
                label.position.z = 0.13;
                label.position.y = 0.1;
                bottleGroup.add(label);
                // –°–≤–µ—á–µ–Ω–∏–µ
                const glowLight = new THREE.PointLight(drug.color, 0.3, 1.5);
                glowLight.position.set(0, 0.2, 0);
                bottleGroup.add(glowLight);
                bottleGroup.position.set(pos[0], pos[1], pos[2]);
                scene.add(bottleGroup);
                gameObjects.push(bottleGroup);
            });
        }
        function createPatients() {
            PATIENTS.forEach((patientData, index) => {
                const patientGroup = new THREE.Group();
                patientGroup.userData = {
                    type: 'patient',
                    id: index,
                    data: patientData,
                    healed: false
                };
                // –ö—Ä–æ–≤–∞—Ç—å
                const bedGeometry = new THREE.BoxGeometry(1.5, 0.2, 2);
                const bedMaterial = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
                const bed = new THREE.Mesh(bedGeometry, bedMaterial);
                bed.position.y = 0.1;
                bed.receiveShadow = true;
                patientGroup.add(bed);
                // –ù–æ–∂–∫–∏ –∫—Ä–æ–≤–∞—Ç–∏
                for (let i = -1; i <= 1; i += 2) {
                    for (let j = -1; j <= 1; j += 2) {
                        const legGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.4, 8);
                        const leg = new THREE.Mesh(legGeometry, bedMaterial);
                        leg.position.set(i * 0.6, -0.3, j * 0.8);
                        patientGroup.add(leg);
                    }
                }
                // –¢–µ–ª–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ (–º–∞–Ω–∏–∫–µ–Ω)
                const bodyGeometry = new THREE.BoxGeometry(0.8, 0.3, 1.5);
                const bodyMaterial = new THREE.MeshStandardMaterial({
                    color: 0xffddcc,
                    roughness: 0.8
                });
                const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                body.position.y = 0.35;
                body.castShadow = true;
                body.name = "body";
                patientGroup.add(body);
                // –ì–æ–ª–æ–≤–∞
                const headGeometry = new THREE.SphereGeometry(0.2, 16, 16);
                const headMaterial = new THREE.MeshStandardMaterial({
                    color: 0xffccaa,
                    roughness: 0.7
                });
                const head = new THREE.Mesh(headGeometry, headMaterial);
                head.position.y = 0.35;
                head.position.z = -0.5;
                head.castShadow = true;
                head.name = "head";
                patientGroup.add(head);
                // –ù–æ–≥–∏
                for (let i = -1; i <= 1; i += 2) {
                    const legGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.6, 8);
                    const leg = new THREE.Mesh(legGeometry, bodyMaterial);
                    leg.position.set(i * 0.2, -0.2, 0.3);
                    patientGroup.add(leg);
                }
                // –†—É–∫–∏
                for (let i = -1; i <= 1; i += 2) {
                    const armGeometry = new THREE.CylinderGeometry(0.06, 0.06, 0.4, 8);
                    const arm = new THREE.Mesh(armGeometry, bodyMaterial);
                    arm.position.set(i * 0.5, 0.35, 0);
                    arm.rotation.z = i * 0.3;
                    patientGroup.add(arm);
                }
                // –Ø—Ä–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–æ–ª–µ–∑–Ω–∏
                const illnessIndicator = new THREE.PointLight(0xff0000, 1, 3);
                illnessIndicator.position.set(0, 1, 0);
                illnessIndicator.name = "illnessLight";
                patientGroup.add(illnessIndicator);
                // –ü—É–ª—å—Å–∏—Ä—É—é—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç
                const pulseGeometry = new THREE.SphereGeometry(0.3, 16, 16);
                const pulseMaterial = new THREE.MeshBasicMaterial({
                    color: 0xff0000,
                    transparent: true,
                    opacity: 0.3
                });
                const pulseSphere = new THREE.Mesh(pulseGeometry, pulseMaterial);
                pulseSphere.position.set(0, 1, 0);
                pulseSphere.name = "pulseSphere";
                patientGroup.add(pulseSphere);
                patientGroup.position.set(
                    patientData.position.x,
                    0,
                    patientData.position.z
                );
               
                scene.add(patientGroup);
                gameObjects.push(patientGroup);
                // –°–æ–∑–¥–∞–µ–º DOM-–ø–æ–¥—Å–≤–µ—Ç–∫—É –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞
                createPatientHighlight(patientData.position, patientData);
            });
        }
    function createPatientHighlight(position, patientData) {
    const highlight = document.createElement('div');
    highlight.className = 'patient-highlight';
    highlight.style.left = '50%';
    highlight.style.top = '50%';
    highlight.id = `patient-highlight-${patientHighlights.length}`;
    document.getElementById('ui-overlay').appendChild(highlight);
   
    // –°–æ–∑–¥–∞–µ–º –Ω–∞–¥–ø–∏—Å—å —Å –¥–∏–∞–≥–Ω–æ–∑–æ–º
    const label = document.createElement('div');
    label.className = 'patient-label';
    label.id = `patient-label-${patientHighlights.length}`;
    label.innerHTML = `
        <h4>${patientData.name}</h4>
        <div class="diagnosis">${patientData.diagnosis}</div>
        <div class="description">${patientData.description}</div>
    `;
    document.getElementById('ui-overlay').appendChild(label);
   
    patientHighlights.push({highlight, label, patientData});
}
    function updatePatientHighlights() {
    // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —Ç—Ä—ë—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ (–≤ % –æ—Ç —ç–∫—Ä–∞–Ω–∞)
    const positions = [
        { left: '50%', top: '30%' }, // –ì—Ä–∏–≥–æ—Ä–∏–π - —Ü–µ–Ω—Ç—Ä, —á—É—Ç—å –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞
        { left: '20%', top: '35%' }, // –ú–∞—Ä–∏—è - —Å–ª–µ–≤–∞
        { right: '20%', top: '35%' } // –ò–≤–∞–Ω - —Å–ø—Ä–∞–≤–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º right –≤–º–µ—Å—Ç–æ left)
    ];
    patientHighlights.forEach((patientObj, index) => {
        const {highlight, label} = patientObj;
        const pos = positions[index];
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ (–∫—Ä—É–≥–ª–∞—è)
        highlight.style.display = 'block';
        if (pos.left) highlight.style.left = pos.left;
        if (pos.right) highlight.style.right = pos.right;
        highlight.style.top = pos.top;
        highlight.style.transform = 'translate(-50%, -50%)';
        // –ù–∞–¥–ø–∏—Å—å
        label.style.display = 'block';
        if (pos.left) label.style.left = pos.left;
        if (pos.right) label.style.right = pos.right;
        label.style.top = pos.top;
        label.style.transform = 'translate(-50%, -100%)';
        // –î–ª—è –≤—ã–ª–µ—á–µ–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
        const patient = gameObjects.find(obj =>
            obj.userData && obj.userData.type === 'patient' && obj.userData.id === index
        );
        if (patient && patient.userData.healed) {
            label.classList.add('healed');
            label.querySelector('.diagnosis').textContent = '‚úÖ –í—ã–ª–µ—á–µ–Ω';
        } else {
            label.classList.remove('healed');
        }
    });
}
        function createChristmasTree() {
            const treeGroup = new THREE.Group();
           
            // –°—Ç–≤–æ–ª
            const trunkGeometry = new THREE.CylinderGeometry(0.2, 0.3, 1, 8);
            const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 0.5;
            treeGroup.add(trunk);
            // –Ø—Ä—É—Å—ã –µ–ª–∫–∏
            const tiers = [
                { radius: 1.5, height: 1, y: 1.5 },
                { radius: 1.2, height: 0.8, y: 2.3 },
                { radius: 0.9, height: 0.6, y: 2.9 },
                { radius: 0.6, height: 0.4, y: 3.3 }
            ];
            tiers.forEach(tier => {
                const coneGeometry = new THREE.ConeGeometry(tier.radius, tier.height, 8);
                const coneMaterial = new THREE.MeshStandardMaterial({ color: 0x228b22 });
                const cone = new THREE.Mesh(coneGeometry, coneMaterial);
                cone.position.y = tier.y;
                treeGroup.add(cone);
            });
            // –ó–≤–µ–∑–¥–∞ –Ω–∞ –≤–µ—Ä—Ö—É—à–∫–µ
            const starGeometry = new THREE.ConeGeometry(0.3, 0.5, 5);
            const starMaterial = new THREE.MeshStandardMaterial({ color: 0xffd700, emissive: 0xffaa00 });
            const star = new THREE.Mesh(starGeometry, starMaterial);
            star.position.y = 3.8;
            star.rotation.y = Math.PI / 10;
            treeGroup.add(star);
            // –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ —à–∞—Ä—ã
            const ballColors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff];
            for (let i = 0; i < 20; i++) {
                const ballGeometry = new THREE.SphereGeometry(0.1, 8, 8);
                const ballMaterial = new THREE.MeshStandardMaterial({
                    color: ballColors[i % ballColors.length],
                    emissive: ballColors[i % ballColors.length],
                    emissiveIntensity: 0.3
                });
                const ball = new THREE.Mesh(ballGeometry, ballMaterial);
               
                const angle = (i / 20) * Math.PI * 2;
                const radius = 0.5 + Math.random() * 0.8;
                const height = 1 + Math.random() * 2;
               
                ball.position.set(
                    Math.cos(angle) * radius,
                    height,
                    Math.sin(angle) * radius
                );
                treeGroup.add(ball);
            }
            treeGroup.position.set(-8, 0, 0);
            scene.add(treeGroup);
        }
        function initSnow() {
            const canvas = document.getElementById('snow-canvas');
            const ctx = canvas.getContext('2d');
           
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
           
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
           
            // –°–æ–∑–¥–∞–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏
            for (let i = 0; i < 200; i++) {
                snowParticles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    r: Math.random() * 3 + 1,
                    d: Math.random() * 2 + 1,
                    o: Math.random() * 0.5 + 0.5
                });
            }
           
            function drawSnow() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
               
                snowParticles.forEach(p => {
                    ctx.beginPath();
                    ctx.globalAlpha = p.o;
                    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                   
                    p.y += p.d;
                    p.x += Math.sin(p.y * 0.01) * 0.5;
                   
                    if (p.y > canvas.height) {
                        p.y = -10;
                        p.x = Math.random() * canvas.width;
                    }
                });
            }
           
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–Ω–µ–≥–∞
            function animateSnow() {
                drawSnow();
                requestAnimationFrame(animateSnow);
            }
           
            animateSnow();
        }
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï ==========
        function setupControls() {
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            document.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
               
                if (e.key === 'e' || e.key === 'E') {
                    interact();
                }
               
                if (e.key === 'c' || e.key === 'C') {
                    toggleCamera();
                }
            });
            document.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à—å—é - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ß–ê–°–¢–¨ (—É–±—Ä–∞–Ω–∞ –∏–Ω–≤–µ—Ä—Å–∏—è)
            document.addEventListener('mousemove', (e) => {
                if (document.pointerLockElement === renderer.domElement) {
                    // –£–±–∏—Ä–∞–µ–º –º–∏–Ω—É—Å—ã - —Ç–µ–ø–µ—Ä—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                    mouseX += e.movementX * 0.002;
                    mouseY += e.movementY * 0.002;
                    mouseY = Math.max(-Math.PI/2, Math.min(Math.PI/2, mouseY));
                }
            });
            document.addEventListener('click', () => {
                if (!isMobile && document.pointerLockElement !== renderer.domElement) {
                    renderer.domElement.requestPointerLock();
                }
            });
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', onWindowResize);
        }
       
   
        function setupEventListeners() {
            document.getElementById('camera-toggle').addEventListener('click', toggleCamera);
            document.getElementById('music-control').addEventListener('click', toggleMusic);
        }
       
        function toggleMusic() {
            const music = document.getElementById('background-music');
            if (music.paused) {
                music.play();
                document.getElementById('music-control').innerHTML = "üîä";
            } else {
                music.pause();
                document.getElementById('music-control').innerHTML = "üîá";
            }
        }
        function toggleCamera() {
            if (!cameraInitialized) return;
           
            cameraMode = cameraMode === 'firstPerson' ? 'thirdPerson' : 'firstPerson';
            updateCameraPosition();
        }
        function updateCameraPosition() {
            if (!player || !camera) return;
           
            if (cameraMode === 'firstPerson') {
                camera.position.set(player.position.x, CONFIG.cameraHeight, player.position.z);
                camera.rotation.order = 'YXZ';
                camera.rotation.x = mouseY;
                camera.rotation.y = mouseX;
            } else {
                // –¢—Ä–µ—Ç–∏–π —á–µ–ª–æ–≤–µ–∫ - –∫–∞–º–µ—Ä–∞ –ø–æ–∑–∞–¥–∏ –∏–≥—Ä–æ–∫–∞
                const distance = 5;
                const height = 3;
                const offsetX = Math.sin(mouseX) * distance;
                const offsetZ = Math.cos(mouseX) * distance;
               
                camera.position.set(
                    player.position.x + offsetX,
                    CONFIG.cameraHeight + height,
                    player.position.z + offsetZ
                );
                camera.lookAt(player.position.x, player.position.y, player.position.z);
            }
        }
        // ========== –î–í–ò–ñ–ï–ù–ò–ï –ò–ì–†–û–ö–ê ==========
          function updatePlayerMovement() {
            if (!player || isCameraAnimating) return; // –ù–µ –¥–≤–∏–≥–∞–µ–º—Å—è –≤–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–∞–º–µ—Ä—ã
            const speed = isMobile ? CONFIG.mobileSpeed : CONFIG.playerSpeed;
            const moveVector = new THREE.Vector3();
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            if (!isMobile) {
                if (keys['w'] || keys['arrowup']) {
                    moveVector.z -= 1;
                }
                if (keys['s'] || keys['arrowdown']) {
                    moveVector.z += 1;
                }
                if (keys['a'] || keys['arrowleft']) {
                    moveVector.x -= 1;
                }
                if (keys['d'] || keys['arrowright']) {
                    moveVector.x += 1;
                }
            }
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –¥–∂–æ–π—Å—Ç–∏–∫–∞
            else if (joystickActive) {
                moveVector.x = joystickVector.x;
                moveVector.z = joystickVector.y;
            }
            // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
            if (moveVector.length() > 0) {
                moveVector.normalize();
               
                // –ü–æ–≤–æ—Ä–æ—Ç –¥–≤–∏–∂–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
                const angle = cameraMode === 'firstPerson' ? mouseX : 0;
                moveVector.applyAxisAngle(new THREE.Vector3(0, 1, 0), angle);
               
                player.position.x += moveVector.x * speed;
                player.position.z += moveVector.z * speed;
               
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ –≥—Ä–∞–Ω–∏—Ü–∞–º –º–∏—Ä–∞
                const halfSize = CONFIG.worldSize / 2 - 2;
                player.position.x = Math.max(-halfSize, Math.min(halfSize, player.position.x));
                player.position.z = Math.max(-halfSize, Math.min(halfSize, player.position.z));
               
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∏–≥—Ä–æ–∫–∞
                if (playerMesh) {
                    playerMesh.position.set(player.position.x, 0.4, player.position.z);
                   
                    if (cameraMode === 'thirdPerson' && moveVector.length() > 0) {
                        playerMesh.rotation.y = Math.atan2(moveVector.x, moveVector.z);
                    }
                }
            }
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
            checkInteractions();
        }
        // ========== –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø ==========
        function checkInteractions() {
            let closestObject = null;
            let closestDistance = CONFIG.interactionDistance + 1;
            gameObjects.forEach(obj => {
                if (obj.userData && !obj.userData.taken && !obj.userData.healed) {
                    const distance = player.position.distanceTo(obj.position);
                    if (distance < CONFIG.interactionDistance && distance < closestDistance) {
                        closestDistance = distance;
                        closestObject = obj;
                    }
                }
            });
            currentInteraction = closestObject;
           
            if (closestObject) {
                showInteractionHint(closestObject.userData.type, closestObject.userData.data?.name);
            } else {
                hideInteractionHint();
            }
        }
        function showInteractionHint(type, name = '') {
            const hint = document.getElementById('interaction-hint');
            let text = isMobile ? "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É " : "–ù–∞–∂–º–∏—Ç–µ E ";
           
            switch(type) {
                case 'drug':
                    text += `—á—Ç–æ–±—ã –≤–∑—è—Ç—å ${name}`;
                    break;
                case 'patient':
                    text += "—á—Ç–æ–±—ã –¥–∞—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –ø–∞—Ü–∏–µ–Ω—Ç—É";
                    break;
            }
           
            hint.textContent = text;
            hint.style.display = 'block';
        }
        function hideInteractionHint() {
            document.getElementById('interaction-hint').style.display = 'none';
        }
        function interact() {
            if (!currentInteraction) return;
            const userData = currentInteraction.userData;
           
            switch(userData.type) {
                case 'drug':
                    pickUpDrug(currentInteraction);
                    break;
                case 'patient':
                    treatPatient(currentInteraction);
                    break;
            }
        }
        function pickUpDrug(drugObject) {
            if (inventory.length >= 3) {
                showMessage("–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª–æ–Ω! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –Ω–∞ –ø–∞—Ü–∏–µ–Ω—Ç–µ.");
                return;
            }
            const drugData = drugObject.userData;
            drugData.taken = true;
           
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            inventory.push(drugData.id);
            updateInventory();
           
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –≤–∑—è—Ç–∏—è
            drugObject.visible = false;
           
            // –ê–Ω–∏–º–∞—Ü–∏—è
            showMessage(`–í–∑—è—Ç–æ: ${drugData.data.name} - ${drugData.data.description}`);
            playAnimation('pickup', drugData.data.color);
        }
        function treatPatient(patientObject) {
    if (inventory.length === 0) {
        showMessage("–£ –≤–∞—Å –Ω–µ—Ç –ª–µ–∫–∞—Ä—Å—Ç–≤!");
        return;
    }
    const patientData = patientObject.userData;
    const drugId = inventory[0];
    const drugData = DRUG_DATABASE[drugId];
    const isCorrect = drugId === patientData.data.correctDrug;
   
    // –û–¢–õ–ê–î–ö–ê
    console.log("–õ–µ—á–∏–º –ø–∞—Ü–∏–µ–Ω—Ç–∞:", patientData.data.name);
    console.log("–ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–∫–∞—Ä—Å—Ç–≤–æ:", drugData.name);
    console.log("–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ:", patientData.data.correctDrug);
    console.log("–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:", isCorrect);
    console.log("–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ:", patientProgress);
    // –£–¥–∞–ª—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ
    inventory.shift();
    updateInventory();
   
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∑—è—Ç–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –Ω–∞ –º–µ—Å—Ç–æ
    restoreDrugs();
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç
    if (isCorrect) {
        // –ë–ª–æ–∫–∏—Ä—É–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        isCameraAnimating = true;
       
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
        animateCameraToPatient(patientObject, () => {
            // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ
            patientProgress += drugData.effect;
            patientHealth = Math.min(100, patientHealth + 10);
           
            console.log("–ù–æ–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ—Å–ª–µ:", patientProgress);
           
            showMessage(`‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ! ${drugData.name} –ø–æ–º–æ–≥–∞–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç—É`);
            playAdvancedDrugAnimation(drugData, patientObject);
           
            if (patientProgress >= 100) {
                console.log("–ü–∞—Ü–∏–µ–Ω—Ç –≤—ã–ª–µ—á–µ–Ω!");
                completePatient(patientObject);
            }
           
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            setTimeout(() => {
                isCameraAnimating = false;
            }, 4000);
        });
       
    } else {
        // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ
        patientHealth -= 25;
        showMessage(`‚úó –û—à–∏–±–∫–∞! ${drugData.name} –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è ${patientData.data.diagnosis}`);
        playAnimation('wrong', 0xff0000);
       
        if (patientHealth <= 0) {
            gameOver();
            return;
        }
    }
    updateUI();
}
        // ========== –ê–ù–ò–ú–ê–¶–ò–ò ==========
        function playDrugAnimation(drugData, patientObject) {
            const overlay = document.getElementById('animation-overlay');
            overlay.innerHTML = '';
            overlay.style.display = 'block';
            // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –º–∞–Ω–∏–∫–µ–Ω–µ
            const patientPosition = patientObject.position;
            const vector = new THREE.Vector3(patientPosition.x, 1, patientPosition.z);
            vector.project(camera);
           
            const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
            const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
           
            const effect = document.createElement('div');
            effect.className = 'manikin-effect';
            effect.style.left = `${x - 50}px`;
            effect.style.top = `${y - 50}px`;
            effect.style.setProperty('--effect-color', drugData.effectColor);
            overlay.appendChild(effect);
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞
            switch(drugData.animation) {
                case 'antibiotic':
                    playAntibioticAnimation();
                    break;
                case 'feverReduction':
                    playFeverReductionAnimation();
                    break;
                default:
                    playDefaultAnimation(drugData);
            }
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 3000);
        }
        function playAntibioticAnimation() {
            const overlay = document.getElementById('animation-overlay');
            overlay.classList.add('cell-animation');
            // –°–æ–∑–¥–∞–Ω–∏–µ –∏–º–º—É–Ω–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫
            for (let i = 0; i < CONFIG.cellCount; i++) {
                setTimeout(() => {
                    const immuneCell = document.createElement('div');
                    immuneCell.className = 'immune-cell';
                    immuneCell.style.left = `${Math.random() * 100}%`;
                    immuneCell.style.top = `${Math.random() * 100}%`;
                    overlay.appendChild(immuneCell);
                    const bacteriaCell = document.createElement('div');
                    bacteriaCell.className = 'bacteria-cell';
                    bacteriaCell.style.left = `${Math.random() * 100}%`;
                    bacteriaCell.style.top = `${Math.random() * 100}%`;
                    overlay.appendChild(bacteriaCell);
                    // –ê–Ω—Ç–∏—Ç–µ–ª–∞ –∞—Ç–∞–∫—É—é—Ç –±–∞–∫—Ç–µ—Ä–∏–∏
                    setTimeout(() => {
                        const antibody = document.createElement('div');
                        antibody.className = 'antibody-particle';
                        antibody.style.left = immuneCell.style.left;
                        antibody.style.top = immuneCell.style.top;
                        antibody.style.setProperty('--tx', `${Math.random() * 100 - 50}px`);
                        antibody.style.setProperty('--ty', `${Math.random() * 100 - 50}px`);
                        overlay.appendChild(antibody);
                    }, 500);
                }, i * 50);
            }
        }
        function playFeverReductionAnimation() {
            const overlay = document.getElementById('animation-overlay');
            overlay.classList.add('glow-animation');
            // –≠—Ñ—Ñ–µ–∫—Ç –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è
            const coolingEffect = document.createElement('div');
            coolingEffect.style.position = 'absolute';
            coolingEffect.style.width = '100%';
            coolingEffect.style.height = '100%';
            coolingEffect.style.background = 'radial-gradient(circle at center, rgba(100, 200, 255, 0.3), transparent)';
            coolingEffect.style.animation = 'pulseGlow 2s ease-in-out';
            overlay.appendChild(coolingEffect);
        }
        function playAnimation(type, color = 0xffffff) {
            const overlay = document.getElementById('animation-overlay');
            overlay.innerHTML = '';
            overlay.style.display = 'block';
            if (type === 'pickup') {
                const flash = document.createElement('div');
                flash.className = 'flash-effect';
                overlay.appendChild(flash);
            } else if (type === 'wrong') {
                const shakeEffect = document.createElement('div');
                shakeEffect.style.position = 'absolute';
                shakeEffect.style.width = '100%';
                shakeEffect.style.height = '100%';
                shakeEffect.style.background = 'rgba(255, 0, 0, 0.3)';
                shakeEffect.style.animation = 'flash 0.5s ease-out';
                overlay.appendChild(shakeEffect);
            }
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 1000);
        }
         function restoreDrugs() {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –≤–∑—è—Ç—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã
            gameObjects.forEach(obj => {
                if (obj.userData && obj.userData.type === 'drug' && obj.userData.taken) {
                    const originalPos = originalDrugPositions.get(obj);
                    if (originalPos) {
                        obj.position.set(originalPos.x, originalPos.y, originalPos.z);
                        obj.visible = true;
                        obj.userData.taken = false;
                    }
                }
            });
        }
       function playAdvancedDrugAnimation(drugData, patientObject) {
            const overlay = document.getElementById('animation-overlay');
            overlay.innerHTML = '';
            overlay.style.display = 'block';
           
            // –°–æ–∑–¥–∞–µ–º —Å–Ω–µ–∂–Ω—ã–π –≤–∏—Ö—Ä—å —Å –º–æ–ª–µ–∫—É–ª–∞–º–∏
            const battleContainer = document.createElement('div');
            battleContainer.className = 'molecule-battle';
            overlay.appendChild(battleContainer);
           
            // –°–æ–∑–¥–∞–µ–º –º–æ–ª–µ–∫—É–ª—ã –¥–ª—è –±–∏—Ç–≤—ã
            const moleculeCount = 50;
           
            for (let i = 0; i < moleculeCount; i++) {
                setTimeout(() => {
                    // –•–æ—Ä–æ—à–∏–µ –º–æ–ª–µ–∫—É–ª—ã (–∑–µ–ª–µ–Ω—ã–µ)
                    const goodMolecule = document.createElement('div');
                    goodMolecule.className = 'molecule good-molecule';
                    goodMolecule.style.width = `${Math.random() * 20 + 10}px`;
                    goodMolecule.style.height = goodMolecule.style.width;
                    goodMolecule.style.left = `${Math.random() * 100}%`;
                    goodMolecule.style.top = `${Math.random() * 100}%`;
                    goodMolecule.style.animationDelay = `${Math.random() * 2}s`;
                    goodMolecule.style.opacity = Math.random() * 0.7 + 0.3;
                    battleContainer.appendChild(goodMolecule);
                   
                    // –ü–ª–æ—Ö–∏–µ –º–æ–ª–µ–∫—É–ª—ã (–∫—Ä–∞—Å–Ω—ã–µ)
                    const badMolecule = document.createElement('div');
                    badMolecule.className = 'molecule bad-molecule';
                    badMolecule.style.width = `${Math.random() * 20 + 10}px`;
                    badMolecule.style.height = badMolecule.style.width;
                    badMolecule.style.left = `${Math.random() * 100}%`;
                    badMolecule.style.top = `${Math.random() * 100}%`;
                    badMolecule.style.animationDelay = `${Math.random() * 2}s`;
                    badMolecule.style.opacity = Math.random() * 0.7 + 0.3;
                    battleContainer.appendChild(badMolecule);
                   
                    // –ê–Ω–∏–º–∞—Ü–∏—è —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                    setTimeout(() => {
                        // –≠—Ñ—Ñ–µ–∫—Ç –≤–∑—Ä—ã–≤–∞ –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏
                        const explosion = document.createElement('div');
                        explosion.style.position = 'absolute';
                        explosion.style.width = '30px';
                        explosion.style.height = '30px';
                        explosion.style.background = 'radial-gradient(circle, #ffff00, transparent 70%)';
                        explosion.style.borderRadius = '50%';
                        explosion.style.left = goodMolecule.style.left;
                        explosion.style.top = goodMolecule.style.top;
                        explosion.style.animation = 'flash 0.5s ease-out';
                        battleContainer.appendChild(explosion);
                       
                        // –£–¥–∞–ª—è–µ–º –º–æ–ª–µ–∫—É–ª—ã –ø–æ—Å–ª–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                        setTimeout(() => {
                            goodMolecule.style.opacity = '0';
                            badMolecule.style.opacity = '0';
                            explosion.remove();
                        }, 500);
                    }, 1000 + Math.random() * 1000);
                }, i * 100);
            }
           
            // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –º–∞–Ω–∏–∫–µ–Ω–µ
            const patientPosition = patientObject.position;
            const vector = new THREE.Vector3(patientPosition.x, 1, patientPosition.z);
            vector.project(camera);
           
            const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
            const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
           
            const effect = document.createElement('div');
            effect.className = 'manikin-effect';
            effect.style.left = `${x - 50}px`;
            effect.style.top = `${y - 50}px`;
            effect.style.setProperty('--effect-color', drugData.effectColor);
            overlay.appendChild(effect);
            setTimeout(() => {
                overlay.style.display = 'none';
                battleContainer.innerHTML = '';
            }, 4000);
        }
         function returnCameraToPlayer() {
            const startPos = camera.position.clone();
            const targetPos = new THREE.Vector3(
                player.position.x,
                CONFIG.cameraHeight,
                player.position.z
            );
           
            let progress = 0;
            const duration = 1000;
           
            function animateReturn() {
                progress += 16.67;
                const t = Math.min(progress / duration, 1);
               
                const easeT = t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;
               
                camera.position.lerpVectors(startPos, targetPos, easeT);
                camera.rotation.order = 'YXZ';
                camera.rotation.x = mouseY;
                camera.rotation.y = mouseX;
               
                if (t < 1) {
                    requestAnimationFrame(animateReturn);
                }
            }
           
            animateReturn();
        }
        function animateCameraToPatient(patientObject, onComplete) {
            const patientPos = patientObject.position.clone();
            patientPos.y += 1; // –ü–æ–¥–Ω–∏–º–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞
           
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –∫–∞–º–µ—Ä—ã
            const startPos = camera.position.clone();
            const startRotation = camera.rotation.clone();
           
            // –¶–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è - –±–ª–∏–∑–∫–æ –∫ –ø–∞—Ü–∏–µ–Ω—Ç—É
            const targetPos = new THREE.Vector3(
                patientPos.x - 1.5,
                patientPos.y + 1,
                patientPos.z - 2
            );
           
            // –¶–µ–ª–µ–≤–æ–π –≤–∑–≥–ª—è–¥ –Ω–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞
            const lookAtPos = new THREE.Vector3(
                patientPos.x,
                patientPos.y,
                patientPos.z
            );
           
            // –ê–Ω–∏–º–∞—Ü–∏—è
            let progress = 0;
            const duration = 1000; // 1 —Å–µ–∫—É–Ω–¥–∞
           
            function animateCamera() {
                progress += 16.67; // –ø—Ä–∏–º–µ—Ä–Ω–æ 60 FPS
                const t = Math.min(progress / duration, 1);
               
                // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
                const easeT = t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;
               
                camera.position.lerpVectors(startPos, targetPos, easeT);
                camera.lookAt(lookAtPos);
               
                if (t < 1) {
                    requestAnimationFrame(animateCamera);
                } else {
                    onComplete();
                   
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–º–µ—Ä—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        returnCameraToPlayer();
                    }, 3000);
                }
            }
           
            animateCamera();
        }
        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        function completePatient(patientObject) {
    patientObject.userData.healed = true;
    curedPatientsCount++;
   
    // –û—Ç–∫–ª—é—á–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–æ–ª–µ–∑–Ω–∏
    patientObject.children.forEach(child => {
        if (child.name === "illnessLight") {
            child.intensity = 0;
        }
        if (child.name === "pulseSphere") {
            child.visible = false;
        }
    });
    // –í–∫–ª—é—á–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–¥–æ—Ä–æ–≤—å—è
    const healthLight = new THREE.PointLight(0x00ff00, 0.8, 3);
    healthLight.position.set(0, 1, 0);
    healthLight.name = "healthLight";
    patientObject.add(healthLight);
    showMessage(`üéâ –ü–∞—Ü–∏–µ–Ω—Ç ${PATIENTS[currentPatient].name} –≤—ã–ª–µ—á–µ–Ω!`);
   
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—ã–ª–µ—á–µ–Ω–Ω—ã—Ö
    document.getElementById('cured-count').textContent = `${curedPatientsCount}/${totalPatients}`;
   
    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–¥–ø–∏—Å—å –ø–∞—Ü–∏–µ–Ω—Ç–∞
    const label = document.getElementById(`patient-label-${patientObject.userData.id}`);
    if (label) {
        label.className = 'patient-label healed';
        const diagnosisEl = label.querySelector('.diagnosis');
        if (diagnosisEl) {
            diagnosisEl.textContent = '‚úÖ –í—ã–ª–µ—á–µ–Ω';
            diagnosisEl.style.color = '#00ff00';
        }
    }
   
    if (curedPatientsCount >= totalPatients) {
        setTimeout(() => gameComplete(), 2000);
    } else {
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞—Ü–∏–µ–Ω—Ç—É
        setTimeout(() => {
            // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–µ–≤—ã–ª–µ—á–µ–Ω–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
            let nextPatientFound = false;
            for (let i = 0; i < PATIENTS.length; i++) {
                const patientObj = gameObjects.find(obj =>
                    obj.userData && obj.userData.type === 'patient' &&
                    obj.userData.id === i && !obj.userData.healed
                );
               
                if (patientObj) {
                    currentPatient = i;
                    patientHealth = 100;
                    patientProgress = 0;
                    nextPatientFound = true;
                    break;
                }
            }
           
            if (nextPatientFound) {
                updateUI();
                showMessage(`–ù–æ–≤—ã–π –ø–∞—Ü–∏–µ–Ω—Ç: ${PATIENTS[currentPatient].name}`);
            }
        }, 2000);
    }
}
        function gameOver() {
            showMessage("üíî –ü–∞—Ü–∏–µ–Ω—Ç –Ω–µ –≤—ã–∂–∏–ª... –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞", 5000);
            setTimeout(() => {
                location.reload();
            }, 5000);
        }
        function gameComplete() {
            document.getElementById('game-complete').style.display = 'flex';
           
            // –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.width = '20px';
                    confetti.style.height = '20px';
                    confetti.style.background = `hsl(${Math.random() * 360}, 100%, 60%)`;
                    confetti.style.borderRadius = '50%';
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.top = '-20px';
                    confetti.style.zIndex = '2001';
                    confetti.style.animation = `fall ${Math.random() * 2 + 2}s linear forwards`;
                   
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes fall {
                            to { transform: translateY(100vh) rotate(${Math.random() * 360}deg); }
                        }
                    `;
                    document.head.appendChild(style);
                    document.body.appendChild(confetti);
                   
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 100);
            }
        }
        // ========== UI –§–£–ù–ö–¶–ò–ò ==========
         // ========== UI –§–£–ù–ö–¶–ò–ò ==========
function updateUI() {
    document.getElementById('health-value').textContent = `${patientHealth}%`;
    document.getElementById('progress-value').textContent = `${patientProgress}%`;
   
    document.getElementById('health-bar').style.width = `${patientHealth}%`;
    document.getElementById('progress-bar').style.width = `${patientProgress}%`;
   
    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∑–¥–æ—Ä–æ–≤—å—è
    const healthBar = document.getElementById('health-bar');
    if (patientHealth > 70) {
        healthBar.style.background = 'linear-gradient(90deg, #4caf50, #8bc34a)';
        healthBar.textContent = `${patientHealth}%`;
    } else if (patientHealth > 30) {
        healthBar.style.background = 'linear-gradient(90deg, #ff9800, #ffb74d)';
        healthBar.textContent = `${patientHealth}%`;
    } else {
        healthBar.style.background = 'linear-gradient(90deg, #f44336, #ef5350)';
        healthBar.textContent = `${patientHealth}%`;
    }
   
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ progress bar
    document.getElementById('progress-bar').textContent = `${patientProgress}%`;
}
        function updateInventory() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –ø—Ä–µ–ø–∞—Ä–∞—Ç
            if (inventory.length > 0) {
                const currentDrug = DRUG_DATABASE[inventory[0]];
                document.getElementById('current-drug').textContent = currentDrug.name;
                document.getElementById('current-drug').style.color = `#${currentDrug.color.toString(16)}`;
            } else {
                document.getElementById('current-drug').textContent = "–ù–µ—Ç";
                document.getElementById('current-drug').style.color = "#ffffff";
            }
           
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–æ—Ç—ã
            for (let i = 1; i <= 3; i++) {
                const slot = document.getElementById(`slot${i}`);
                const drugId = inventory[i - 1];
               
                if (drugId) {
                    const drug = DRUG_DATABASE[drugId];
                    slot.querySelector('.drug-icon').textContent = drug.icon;
                    slot.querySelector('.drug-name').textContent = drug.name.substring(0, 6);
                    slot.className = 'inventory-slot filled';
                    slot.title = `${drug.name}: ${drug.description}`;
                } else {
                    slot.querySelector('.drug-icon').textContent = '';
                    slot.querySelector('.drug-name').textContent = '';
                    slot.className = 'inventory-slot';
                    slot.title = '–ü—É—Å—Ç–æ–π —Å–ª–æ—Ç';
                }
            }
        }
        function showMessage(text, duration = 3000) {
            const messageDisplay = document.getElementById('message-display');
            messageDisplay.textContent = text;
            messageDisplay.style.display = 'block';
           
            setTimeout(() => {
                messageDisplay.style.display = 'none';
            }, duration);
        }
        // ========== –°–ò–°–¢–ï–ú–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        function animate() {
            if (isCameraAnimating) {
                // –ï—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –∞–Ω–∏–º–∏—Ä—É–µ—Ç—Å—è, —Ç–æ–ª—å–∫–æ —Ä–µ–Ω–¥–µ—Ä–∏–º —Å—Ü–µ–Ω—É
                renderer.render(scene, camera);
                requestAnimationFrame(animate);
                return;
            }
           
            animationId = requestAnimationFrame(animate);
           
            if (player) {
                updatePlayerMovement();
            }
           
            if (cameraInitialized) {
                updateCameraPosition();
                updatePatientHighlights();
            }
            // –ê–Ω–∏–º–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
            gameObjects.forEach(obj => {
                if (obj.userData && !obj.userData.healed) {
                    if (obj.userData.type === 'drug' && !obj.userData.taken) {
                        obj.rotation.y += 0.01;
                        obj.position.y = 0.4 + Math.sin(Date.now() * 0.003 + obj.position.x) * 0.05;
                    } else if (obj.userData.type === 'patient' && !obj.userData.healed) {
                        // –ü—É–ª—å—Å–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –±–æ–ª–µ–∑–Ω–∏
                        const pulseSphere = obj.children.find(child => child.name === "pulseSphere");
                        if (pulseSphere) {
                            pulseSphere.scale.x = 1 + Math.sin(Date.now() * 0.005) * 0.2;
                            pulseSphere.scale.y = 1 + Math.sin(Date.now() * 0.005) * 0.2;
                            pulseSphere.scale.z = 1 + Math.sin(Date.now() * 0.005) * 0.2;
                        }
                    }
                }
            });
           
           
            renderer.render(scene, camera);
        }
        // ========== –ó–ê–ü–£–°–ö –ò–ì–†–´ ==========
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', init);
    </script>
</body>
</html>
¬†
